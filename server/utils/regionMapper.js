/**
 * 직장 위치에 따른 추천 거주 지역 매핑
 */

'use strict';

/**
 * 직장 위치별 추천 거주 지역
 * - 출퇴근 시간 60분 이내
 * - 교통 편리성 고려
 */
const workplaceRegionMap = {
    // 서울 강남권
    '강남': ['강남구', '서초구', '송파구', '강동구', '분당구', '수지구', '용인시'],
    '강남구': ['강남구', '서초구', '송파구', '강동구', '분당구', '수지구'],
    '서초': ['서초구', '강남구', '송파구', '관악구', '동작구', '과천시'],
    '서초구': ['서초구', '강남구', '송파구', '관악구', '동작구', '과천시'],
    '송파': ['송파구', '강남구', '강동구', '하남시', '분당구'],
    '송파구': ['송파구', '강남구', '강동구', '하남시', '분당구'],
    '강동': ['강동구', '송파구', '하남시', '강남구'],
    '강동구': ['강동구', '송파구', '하남시', '강남구'],

    // 판교/분당권
    '판교': ['분당구', '수지구', '기흥구', '용인시', '성남시', '광주시'],
    '분당': ['분당구', '수지구', '용인시', '성남시', '광주시'],
    '분당구': ['분당구', '수지구', '용인시', '성남시', '광주시'],
    '성남': ['성남시', '분당구', '수지구', '하남시', '광주시'],
    '성남시': ['성남시', '분당구', '수지구', '하남시', '광주시'],

    // 여의도/영등포권
    '여의도': ['영등포구', '마포구', '양천구', '강서구', '광명시', '부천시'],
    '영등포': ['영등포구', '마포구', '양천구', '동작구', '광명시'],
    '영등포구': ['영등포구', '마포구', '양천구', '동작구', '광명시'],

    // 강서/마곡권
    '마곡': ['강서구', '양천구', '김포시', '부천시', '광명시'],
    '강서': ['강서구', '양천구', '김포시', '부천시', '광명시'],
    '강서구': ['강서구', '양천양천구', '김포시', '부천시', '광명시'],

    // 목동/양천권
    '목동': ['양천구', '강서구', '영등포구', '마포구', '부천시'],
    '양천': ['양천구', '강서구', '영등포구', '마포구', '부천시'],
    '양천구': ['양천구', '강서구', '영등포구', '마포구', '부천시'],

    // 수원/화성권
    '수원': ['수원시', '용인시', '화성시', '오산시', '평택시'],
    '수원시': ['수원시', '용인시', '화성시', '오산시', '평택시'],
    '화성': ['화성시', '수원시', '용인시', '오산시', '평택시', '안산시'],
    '화성시': ['화성시', '수원시', '용인시', '오산시', '평택시', '안산시'],
    '평택': ['평택시', '화성시', '오산시', '안성시'],
    '평택시': ['평택시', '화성시', '오산시', '안성시'],

    // 과천/안양권
    '과천': ['과천시', '안양시', '군포시', '의왕시', '서초구', '동작구'],
    '과천시': ['과천시', '안양시', '군포시', '의왕시', '서초구', '동작구'],
    '안양': ['안양시', '과천시', '군포시', '의왕시', '광명시'],
    '안양시': ['안양시', '과천시', '군포시', '의왕시', '광명시'],
    '군포': ['군포시', '안양시', '의왕시', '수원시'],
    '군포시': ['군포시', '안양시', '의왕시', '수원시'],

    // 용인권
    '용인': ['용인시', '수지구', '기흥구', '처인구', '성남시', '화성시', '광주시'],
    '용인시': ['용인시', '수지구', '기흥구', '처인구', '성남시', '화성시', '광주시'],
    '수지': ['수지구', '용인시', '분당구', '성남시'],
    '수지구': ['수지구', '용인시', '분당구', '성남시'],
    '기흥': ['기흥구', '용인시', '수원시', '화성시'],
    '기흥구': ['기흥구', '용인시', '수원시', '화성시'],

    // 고양/일산권
    '고양': ['고양시', '김포시', '파주시', '마포구', '서대문구'],
    '고양시': ['고양시', '김포시', '파주시', '마포구', '서대문구'],
    '일산': ['고양시', '김포시', '파주시'],

    // 부천권
    '부천': ['부천시', '광명시', '김포시', '강서구', '양천구'],
    '부천시': ['부천시', '광명시', '김포시', '강서구', '양천구'],

    // 광명권
    '광명': ['광명시', '부천시', '영등포구', '양천구', '구로구', '금천구'],
    '광명시': ['광명시', '부천시', '영등포구', '양천구', '구로구', '금천구'],

    // 하남권
    '하남': ['하남시', '강동구', '송파구', '광주시', '성남시'],
    '하남시': ['하남시', '강동구', '송파구', '광주시', '성남시']
};

/**
 * 직장 위치에 따른 추천 거주 지역 조회
 *
 * @param {string} workplace - 직장 위치 (예: "화성", "화성/과천")
 * @returns {Array<string>} 추천 거주 지역 목록
 */
function getRecommendedRegions(workplace) {
    if (!workplace) {
        return [];
    }

    // 복수 직장 위치 처리 (예: "화성/과천")
    const workplaces = workplace.split('/').map(w => w.trim());

    const allRegions = new Set();

    for (const work of workplaces) {
        // 직접 매칭
        if (workplaceRegionMap[work]) {
            workplaceRegionMap[work].forEach(region => allRegions.add(region));
        } else {
            // 부분 매칭 시도 (예: "판교동" -> "판교")
            const matchedKey = Object.keys(workplaceRegionMap).find(key =>
                work.includes(key) || key.includes(work)
            );

            if (matchedKey) {
                workplaceRegionMap[matchedKey].forEach(region => allRegions.add(region));
            } else {
                // 매칭 실패 시 입력된 지역 자체 추가
                allRegions.add(work);
            }
        }
    }

    return Array.from(allRegions);
}

/**
 * 두 지점의 중간 지역 찾기 (간단한 휴리스틱)
 *
 * @param {string} workplace1 - 직장1
 * @param {string} workplace2 - 직장2
 * @returns {Array<string>} 중간 지역 목록
 */
function getMiddleRegions(workplace1, workplace2) {
    const middleRegionMap = {
        '강남_여의도': ['영등포구', '동작구', '서초구', '마포구'],
        '강남_판교': ['분당구', '송파구', '강남구'],
        '화성_과천': ['수원시', '안양시', '의왕시', '군포시', '용인시'],
        '화성_강남': ['수원시', '용인시', '분당구', '과천시'],
        '판교_여의도': ['서초구', '강남구', '송파구', '영등포구'],
        '수원_강남': ['용인시', '분당구', '과천시', '안양시']
    };

    const key1 = `${workplace1}_${workplace2}`;
    const key2 = `${workplace2}_${workplace1}`;

    return middleRegionMap[key1] || middleRegionMap[key2] || [];
}

module.exports = {
    getRecommendedRegions,
    getMiddleRegions,
    workplaceRegionMap
};
